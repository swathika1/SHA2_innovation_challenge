{% extends 'base.html' %}

{% block title %}Progress & History - Home Rehab Coach{% endblock %}

{% block header %}
<header class="header">
    <h1><a href="{{ url_for('patient_dashboard') }}"><img src="{{ url_for('static', filename='rehab-logo.png') }}" alt="Home Rehab Coach logo" class="brand-logo"> Home Rehab Coach</a></h1>
    <nav class="nav-links">
        <a href="{{ url_for('patient_dashboard') }}">Dashboard</a>
        <a href="{{ url_for('patient_appointments') }}">Consultations</a>
        <div class="nav-user">
            <button class="nav-user-btn" title="Account"><i class="fa-solid fa-user"></i></button>
            <div class="nav-user-dropdown">
                <div class="nav-user-dropdown-inner">
                    <div class="dropdown-header">Signed in as<strong>{{ user.name if user else 'Patient' }}</strong></div>
                    <a href="{{ url_for('patient_profile') }}" class="active"><span class="dropdown-icon"><i class="fa-solid fa-user"></i></span> My Profile</a>
                    <div class="dropdown-divider"></div>
                    <a href="{{ url_for('logout') }}" class="dropdown-logout"><span class="dropdown-icon"><i class="fa-solid fa-right-from-bracket"></i></span> Logout</a>
                </div>
            </div>
        </div>
    </nav>
</header>
{% endblock %}

{% block content %}
<style>
    .profile-layout {
        display: flex;
        gap: 28px;
        margin-top: 10px;
        min-height: 70vh;
    }
    .profile-sidebar {
        width: 220px;
        flex-shrink: 0;
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 2px 12px rgba(0,0,0,.07);
        padding: 20px 0;
        align-self: flex-start;
        position: sticky;
        top: 90px;
    }
    .profile-sidebar h3 {
        font-size: .85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #999;
        padding: 0 20px;
        margin: 0 0 12px;
    }
    .profile-sidebar a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 24px;
        color: #333;
        text-decoration: none;
        font-weight: 500;
        font-size: .95rem;
        transition: background .15s, color .15s;
        border-left: 3px solid transparent;
    }
    .profile-sidebar a:hover {
        background: #f4f6fa;
        color: #1a73e8;
    }
    .profile-sidebar a.active {
        background: #eef3ff;
        color: #1a73e8;
        border-left-color: #1a73e8;
        font-weight: 600;
    }
    .profile-sidebar .sidebar-icon { font-size: 1.15rem; }
    .profile-content { flex: 1; min-width: 0; }
    @media (max-width: 768px) {
        .profile-layout { flex-direction: column; gap: 16px; }
        .profile-sidebar {
            width: 100%; position: static;
            display: flex; flex-direction: row; padding: 0;
            border-radius: 12px; overflow-x: auto;
        }
        .profile-sidebar h3 { display: none; }
        .profile-sidebar a {
            border-left: none; border-bottom: 3px solid transparent;
            padding: 14px 20px; white-space: nowrap; font-size: .9rem;
        }
        .profile-sidebar a.active { border-bottom-color: #1a73e8; border-left-color: transparent; }
    }
</style>

<div class="profile-layout">
    <!-- Left Sidebar Navigation -->
    <nav class="profile-sidebar">
        <h3>Profile</h3>
        <a href="{{ url_for('patient_profile') }}">
            <span class="sidebar-icon"><i class="fa-solid fa-user"></i></span> Personal Details
        </a>
        <a href="{{ url_for('progress_history') }}" class="active">
            <span class="sidebar-icon"><i class="fa-solid fa-chart-line"></i></span> Your Progress
        </a>
    </nav>

    <!-- Right Content -->
    <div class="profile-content">

<div class="dashboard-header">
    <h2>Your Progress Overview</h2>
    <div>
        <button class="filter-btn active">Weekly</button>
        <button class="filter-btn">Monthly</button>
        <button class="filter-btn">All Time</button>
    </div>
</div>

<!-- Stats Summary -->
<div class="stats-row">
    <div class="stat-box">
        <div class="stat-value">87%</div>
        <div class="stat-label">Overall Adherence</div>
    </div>
    <div class="stat-box">
        <div class="stat-value">78</div>
        <div class="stat-label">Avg. Quality Score</div>
    </div>
    <div class="stat-box">
        <div class="stat-value">2.8</div>
        <div class="stat-label">Avg. Pain Level</div>
    </div>
    <div class="stat-box">
        <div class="stat-value">+15°</div>
        <div class="stat-label">ROM Improvement</div>
    </div>
</div>

<!-- Charts -->
<div class="grid grid-2">
    <!-- Adherence Chart -->
    <div class="card">
        <div class="card-header">Adherence Rate (Last 4 Weeks)</div>
        <div class="chart-placeholder">
            <div class="bars">
                <div class="bar" style="height: 75%; background: #6c757d;"></div>
                <div class="bar" style="height: 85%; background: #6c757d;"></div>
                <div class="bar" style="height: 80%; background: #6c757d;"></div>
                <div class="bar" style="height: 87%; background: #333;"></div>
            </div>
        </div>
        <div style="display: flex; justify-content: space-around; font-size: 0.8rem; color: #666; margin-top: 10px;">
            <span>Week 1</span>
            <span>Week 2</span>
            <span>Week 3</span>
            <span>Week 4</span>
        </div>
    </div>
    
    <!-- Form Quality Chart -->
    <div class="card">
        <div class="card-header">Form Quality Trend</div>
        <div class="chart-placeholder">
            <div class="bars">
                <div class="bar" style="height: 60%; background: #6c757d;"></div>
                <div class="bar" style="height: 68%; background: #6c757d;"></div>
                <div class="bar" style="height: 72%; background: #6c757d;"></div>
                <div class="bar" style="height: 78%; background: #333;"></div>
            </div>
        </div>
        <div style="display: flex; justify-content: space-around; font-size: 0.8rem; color: #666; margin-top: 10px;">
            <span>Week 1</span>
            <span>Week 2</span>
            <span>Week 3</span>
            <span>Week 4</span>
        </div>
    </div>
</div>

<div class="grid grid-2" style="margin-top: 20px;">
    <!-- Pain Trend Chart -->
    <div class="card">
        <div class="card-header">Pain Level Trend</div>
        <div class="chart-placeholder">
            <div class="bars">
                <div class="bar" style="height: 50%; background: #dc3545;"></div>
                <div class="bar" style="height: 45%; background: #dc3545;"></div>
                <div class="bar" style="height: 35%; background: #ffc107;"></div>
                <div class="bar" style="height: 28%; background: #28a745;"></div>
            </div>
        </div>
        <div style="display: flex; justify-content: space-around; font-size: 0.8rem; color: #666; margin-top: 10px;">
            <span>Week 1</span>
            <span>Week 2</span>
            <span>Week 3</span>
            <span>Week 4</span>
        </div>
        <p style="text-align: center; margin-top: 10px; color: #28a745; font-weight: 600;">↓ Pain decreasing - Great progress!</p>
    </div>
    
    <!-- ROM Progress -->
    <div class="card">
        <div class="card-header">Range of Motion Progress</div>
        <div class="chart-placeholder">
            <div class="bars">
                <div class="bar" style="height: 50%; background: #6c757d;"></div>
                <div class="bar" style="height: 60%; background: #6c757d;"></div>
                <div class="bar" style="height: 70%; background: #6c757d;"></div>
                <div class="bar" style="height: 83%; background: #28a745;"></div>
            </div>
        </div>
        <div style="display: flex; justify-content: space-around; font-size: 0.8rem; color: #666; margin-top: 10px;">
            <span>60°</span>
            <span>68°</span>
            <span>75°</span>
            <span>83°</span>
        </div>
        <p style="text-align: center; margin-top: 10px;">Target: 90° | Current: 83°</p>
    </div>
</div>

<!-- Session History -->
<div class="card" style="margin-top: 20px;">
    <div class="card-header">Recent Sessions</div>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #ddd;">
                <th style="text-align: left; padding: 10px;">Date</th>
                <th style="text-align: left; padding: 10px;">Exercise</th>
                <th style="text-align: center; padding: 10px;">Reps</th>
                <th style="text-align: center; padding: 10px;">Quality</th>
                <th style="text-align: center; padding: 10px;">Pain</th>
                <th style="text-align: center; padding: 10px;">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">Feb 7, 2026</td>
                <td style="padding: 10px;">Knee Extension</td>
                <td style="text-align: center; padding: 10px;">28/30</td>
                <td style="text-align: center; padding: 10px;"><span style="background: #d4edda; padding: 2px 8px; border-radius: 10px;">82</span></td>
                <td style="text-align: center; padding: 10px;">3</td>
                <td style="text-align: center; padding: 10px;"><button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">View</button></td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">Feb 6, 2026</td>
                <td style="padding: 10px;">Hip Flexor Stretch</td>
                <td style="text-align: center; padding: 10px;">20/20</td>
                <td style="text-align: center; padding: 10px;"><span style="background: #d4edda; padding: 2px 8px; border-radius: 10px;">90</span></td>
                <td style="text-align: center; padding: 10px;">2</td>
                <td style="text-align: center; padding: 10px;"><button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">View</button></td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">Feb 4, 2026</td>
                <td style="padding: 10px;">Quad Strengthening</td>
                <td style="text-align: center; padding: 10px;">35/36</td>
                <td style="text-align: center; padding: 10px;"><span style="background: #fff3cd; padding: 2px 8px; border-radius: 10px;">75</span></td>
                <td style="text-align: center; padding: 10px;">4</td>
                <td style="text-align: center; padding: 10px;"><button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">View</button></td>
            </tr>
            <tr>
                <td style="padding: 10px;">Feb 3, 2026</td>
                <td style="padding: 10px;">Knee Extension</td>
                <td style="text-align: center; padding: 10px;">30/30</td>
                <td style="text-align: center; padding: 10px;"><span style="background: #d4edda; padding: 2px 8px; border-radius: 10px;">85</span></td>
                <td style="text-align: center; padding: 10px;">3</td>
                <td style="text-align: center; padding: 10px;"><button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">View</button></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Download Report -->
<div style="text-align: center; margin-top: 30px;">
    <button class="btn btn-primary btn-large"><i class="fa-solid fa-file-lines"></i> Download Session Report (PDF)</button>
</div>

    </div><!-- /.profile-content -->
</div><!-- /.profile-layout -->
{% endblock %}